<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seller Portal - Admin Dashboard</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      margin: 0;
      padding: 0;
    }

    /* üåê Top Navigation */
    .navbar {
      background: #1e293b;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .navbar h2 {
      color: #38bdf8;
      margin: 0;
      font-size: 1.3em;
    }
    .nav-links a {
      color: #e2e8f0;
      text-decoration: none;
      margin-left: 20px;
      font-weight: 500;
      transition: 0.3s;
    }
    .nav-links a:hover {
      color: #38bdf8;
    }

    h1 {
      text-align: center;
      color: #38bdf8;
      margin: 30px 0 10px;
    }

    .container {
      background: #1e293b;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      max-width: 900px;
      margin: auto;
      padding: 25px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #334155;
      padding: 12px;
      text-align: center;
    }

    th {
      background-color: #334155;
      color: #fff;
    }

    tr:nth-child(even) {
      background-color: #1e293b;
    }

    input, select {
      padding: 10px;
      margin: 5px;
      border-radius: 6px;
      border: none;
      width: 180px;
    }

    button {
      background: #38bdf8;
      border: none;
      padding: 10px 20px;
      color: white;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #0ea5e9;
      transform: scale(1.05);
    }

    .add-form {
      text-align: center;
      margin-top: 20px;
    }

    footer {
      text-align: center;
      color: #94a3b8;
      margin-top: 25px;
      padding-bottom: 20px;
    }

    .delete-btn {
      background: #ef4444;
      padding: 6px 12px;
      border-radius: 6px;
      color: #fff;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    .delete-btn:hover {
      background: #dc2626;
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <!-- üß≠ NAVBAR -->
  <div class="navbar">
    <h2>Seller Admin Panel</h2>
    <div class="nav-links">
      <a href="../index.html">üè† Home</a>
      <a href="../buyer/buyer.html">üõí Buyer Site</a>
    </div>
  </div>

  <h1>Manage Products</h1>

  <div class="container">
    <h2>Available Products</h2>
    <table id="productTable">
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price</th>
        <th>Availability</th>
        <th>Action</th>
      </tr>
    </table>

    <div class="add-form">
      <h3>Add New Product</h3>
      <input type="text" id="id" placeholder="Product ID" required>
      <input type="text" id="name" placeholder="Product Name" required>
      <input type="text" id="price" placeholder="Price (‚Çπ)" required>
      <select id="availability">
        <option value="Available">Available</option>
        <option value="Out of Stock">Out of Stock</option>
      </select>
      <button onclick="addProduct()">Add Product</button>
    </div>
  </div>

  <footer>Data synchronized with Buyer Portal (XML simulation)</footer>
<script>
  // Ensure localStorage has products XML. If not, try to load the original products.xml from main folder.
  async function ensureLocalProducts() {
    if (localStorage.getItem('products')) return;
    try {
      const resp = await fetch('../products.xml');
      if (!resp.ok) throw new Error('XML fetch failed');
      const text = await resp.text();
      localStorage.setItem('products', text);
    } catch (err) {
      // If fetching fails (e.g. GitHub CORS) create an initial minimal XML so UI still works
      const fallback = `<?xml version="1.0" encoding="UTF-8"?>
      <products>
        <product><id>101</id><name>Chocolate Cake</name><price>‚Çπ450</price><availability>Available</availability></product>
        <product><id>102</id><name>Red Velvet Cake</name><price>‚Çπ600</price><availability>Out of Stock</availability></product>
        <product><id>103</id><name>Black Forest Cake</name><price>‚Çπ550</price><availability>Available</availability></product>
      </products>`;
      localStorage.setItem('products', fallback);
    }
  }

  // Load and render products into the table
  async function loadProducts() {
    await ensureLocalProducts();
    const xmlText = localStorage.getItem('products');
    const data = new window.DOMParser().parseFromString(xmlText, "text/xml");
    const products = data.getElementsByTagName("product");
    const table = document.getElementById("productTable");

    table.innerHTML = `
      <tr><th>ID</th><th>Name</th><th>Price</th><th>Availability</th><th>Action</th></tr>
    `;

    for (let i = 0; i < products.length; i++) {
      const row = table.insertRow();
      const id = products[i].getElementsByTagName("id")[0].textContent;
      const name = products[i].getElementsByTagName("name")[0].textContent;
      const price = products[i].getElementsByTagName("price")[0].textContent;
      const availability = products[i].getElementsByTagName("availability")[0].textContent;

      row.insertCell(0).innerHTML = id;
      row.insertCell(1).innerHTML = name;
      row.insertCell(2).innerHTML = price;
      row.insertCell(3).innerHTML = availability;
      row.insertCell(4).innerHTML = `<button class='delete-btn' onclick='deleteProduct("${id}")'>Delete</button>`;
    }
  }

  // Add a product (prevents duplicate IDs)
  async function addProduct() {
    await ensureLocalProducts();

    const idEl = document.getElementById('id');
    const nameEl = document.getElementById('name');
    const priceEl = document.getElementById('price');
    const availEl = document.getElementById('availability');

    const id = idEl.value.trim();
    const name = nameEl.value.trim();
   let price = priceEl.value.trim();

// Automatically add ‚Çπ symbol if not present
if (price && !price.startsWith("‚Çπ")) {
  price = "‚Çπ" + price;
}

    const availability = availEl.value.trim() || 'Available';

    if (!id || !name || !price) {
      alert("Please fill all fields (ID, Name, Price).");
      return;
    }

    // Load existing XML from localStorage
    let xmlText = localStorage.getItem('products') || `<?xml version="1.0"?><products></products>`;
    let xmlDoc = new window.DOMParser().parseFromString(xmlText, "text/xml");

    // Strict duplicate check on <id> values
    const existingIds = Array.from(xmlDoc.getElementsByTagName("id")).map(el => el.textContent.trim());
    if (existingIds.includes(id)) {
      alert(`Product with ID "${id}" already exists. Use a unique ID.`);
      return;
    }

    // Create new product element
    const newProduct = xmlDoc.createElement("product");
    const idNode = xmlDoc.createElement("id");
    idNode.textContent = id;
    const nameNode = xmlDoc.createElement("name");
    nameNode.textContent = name;
    const priceNode = xmlDoc.createElement("price");
    priceNode.textContent = price;
    const availNode = xmlDoc.createElement("availability");
    availNode.textContent = availability;

    newProduct.appendChild(idNode);
    newProduct.appendChild(nameNode);
    newProduct.appendChild(priceNode);
    newProduct.appendChild(availNode);

    xmlDoc.documentElement.appendChild(newProduct);

    // Save back to localStorage
    const serializer = new XMLSerializer();
    localStorage.setItem('products', serializer.serializeToString(xmlDoc));

    // UI update
    await loadProducts();
    alert("Product added successfully!");
    clearForm();

    // Notify other tabs (storage event doesn't fire in same tab, but setting the same key triggers event in other tabs)
    // We set again to ensure a different value triggers event: append a tiny timestamp comment
    const annotated = localStorage.getItem('products') + `\n<!--updated:${Date.now()}-->`;
    localStorage.setItem('products', annotated);
    // then restore clean XML (remove our comment)
    localStorage.setItem('products', serializer.serializeToString(xmlDoc));
  }

  // Delete product by ID (with confirmation)
  async function deleteProduct(idToDelete) {
    if (!confirm(`Delete product ${idToDelete}? This action cannot be undone in this session.`)) return;

    await ensureLocalProducts();
    let xmlText = localStorage.getItem('products') || `<?xml version="1.0"?><products></products>`;
    let xmlDoc = new window.DOMParser().parseFromString(xmlText, "text/xml");
    let products = xmlDoc.getElementsByTagName("product");
    let removed = false;

    for (let i = products.length - 1; i >= 0; i--) {
      const idNode = products[i].getElementsByTagName("id")[0];
      if (idNode && idNode.textContent.trim() === idToDelete) {
        products[i].parentNode.removeChild(products[i]);
        removed = true;
        break;
      }
    }

    if (!removed) {
      alert("Product not found.");
      return;
    }

    const serializer = new XMLSerializer();
    localStorage.setItem('products', serializer.serializeToString(xmlDoc));
    await loadProducts();
    alert(`Product ${idToDelete} deleted successfully.`);

    // Notify other tabs (small trick to trigger storage event in other tabs)
    localStorage.setItem('products:lastUpdate', String(Date.now()));
  }

  function clearForm() {
    document.getElementById('id').value = '';
    document.getElementById('name').value = '';
    document.getElementById('price').value = '';
    document.getElementById('availability').value = 'Available';
  }

  // Keep initial load
  loadProducts();


  window.addEventListener('storage', (e) => {
    if (e.key === 'products' || e.key === 'products:lastUpdate') {
      loadProducts();
    }
  });
  
  document.getElementById("price").addEventListener("blur", () => {
  const priceInput = document.getElementById("price");
  if (priceInput.value && !priceInput.value.startsWith("‚Çπ")) {
    priceInput.value = "‚Çπ" + priceInput.value;
  }
});

  
</script>

</body>
</html>
